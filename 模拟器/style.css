/* --- 1. 基础布局和字体 --- */
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "PingFang SC", "Microsoft YaHei", sans-serif;
    background-color: #e9ecef;
    color: #333;
    margin: 0;
    height: 100vh;
    width: 100vw;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    overflow: hidden;
}

h2, h3 {
    color: #1a2e42;
    border-bottom: 1px solid #e0e0e0;
    padding-bottom: 10px;
    margin-top: 0;
}

p {
    font-size: 12px; 
    color: #8b949e;
    margin-top: -8px;
}

/* --- 2. 页面画框 --- */
#page-wrapper {
    width: 100%;
    height: 100%; 
    margin: 0; 
    padding: 15px;
    background-color: #fcfcfc;
    border: none;
    box-sizing: border-box;
    display: flex; 
}

/* --- 3. 三栏布局 --- */
#app-container {
    display: flex;
    gap: 20px;
    width: 100%;
    height: 100%;
    position: relative;
}

#left-panel, #right-panel {
    background-color: #ffffff;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    display: flex;
    flex-direction: column;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    flex-shrink: 0; 
    z-index: 10;
    padding: 15px;
}

#left-panel { width: 290px; }
#right-panel { width: 250px; overflow-y: auto; }

#middle-panel {
    flex-grow: 1; 
    padding: 15px;
    background-color: #ffffff;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    overflow: auto;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    position: relative;
    z-index: 5;
    display: flex;
    flex-direction: column;
}

#piece-count {
    font-size: 16px;
    font-weight: normal;
    color: #6c757d;
    margin-left: 10px;
}
#piece-count.full {
    color: #dc3545;
    font-weight: bold;
}

/* --- 4. 左侧选项卡 --- */
.tab-list {
    display: flex;
    gap: 5px;
    margin-top: -10px;
    margin-bottom: 15px;
}
.tab-btn {
    flex-grow: 1;
    padding: 8px 5px; /* 稍微调小padding以容纳4个按钮 */
    font-size: 14px;
    font-weight: bold;
    border: 1px solid #ced4da;
    background-color: #f8f9fa;
    color: #495057;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap; /* 防止文字换行 */
}
.tab-btn:hover { background-color: #e9ecef; }
.tab-btn.active { color: #fff; border-color: #007bff; background-color: #007bff; }
.tab-btn.active[data-quality="金"] { background-color: #ffc107; border-color: #ffc107; color: #343a40;}
.tab-btn.active[data-quality="紫"] { background-color: #8800ff; border-color: #8800ff; }
.tab-btn.active[data-quality="蓝"] { background-color: #007bff; border-color: #007bff; }
.tab-btn.active[data-quality="filter"] { background-color: #17a2b8; border-color: #17a2b8; color: #fff; }

#piece-list-container { flex-grow: 1; overflow-y: auto; }
#piece-list {
    display: grid;
    grid-template-columns: repeat(4, 60px); 
    gap: 10px;
    justify-content: center;
}

/* --- 5. 棋子样式 --- */
.piece {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    border: 2px solid #343a40;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    cursor: grab;
    text-align: center;
    box-sizing: border-box;
    transition: transform 0.1s ease;
    position: relative;
    width: 60px;
    height: 80px; 
    padding-top: 5px;
    background-color: #f8f9fa;
    z-index: 10;
}
.piece:active { cursor: grabbing; transform: scale(1.1); z-index: 100; }

.piece-avatar {
    width: 48px; height: 48px; border-radius: 4px; object-fit: cover; border: 1px solid #ddd; pointer-events: none;
    position: relative; z-index: 2; background-color: #fff;
}
.piece-img-placeholder {
    width: 48px; height: 48px; border-radius: 4px; background-color: #6c757d; color: white; font-size: 24px;
    font-weight: bold; display: flex; align-items: center; justify-content: center; position: absolute; top: 5px; left: 5px; z-index: 1;
}
.piece-name {
    font-size: 12px; font-weight: bold; margin-top: 4px; width: 100%; padding: 0 2px;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #333; 
}

.piece.quality-蓝 { border-color: #007bff; background-color: #e6f2ff; }
.piece.quality-紫 { border-color: #8800ff; background-color: #f2e6ff; }
.piece.quality-金 { border-color: #ffc107; background-color: #fff3cd; }

/* 棋盘上的棋子 */
#chessboard .piece {
    cursor: move; border: 1px solid #555; background-color: #fff; width: 58px; height: 58px;
    padding-top: 0; justify-content: center; margin: 1px 0 0 1px;
}
#chessboard .piece .piece-avatar { width: 58px; height: 58px; border: none; margin: 0; border-radius: 3px; }
#chessboard .piece .piece-img-placeholder { width: 58px; height: 58px; top: 0; left: 0; margin: 0; border-radius: 3px; }
#chessboard .piece .piece-name { display: none; }
#chessboard .piece.piece-highlight { border-color: #19ff4d; box-shadow: 0 0 10px 3px rgba(25, 255, 77, 0.7); }

.piece-name-wrapper {
    position: absolute; bottom: 0; left: 0; width: 100%; height: 20px;
    display: flex; align-items: center; justify-content: center; pointer-events: none; z-index: 11;
}
.piece-name-wrapper .piece-name {
    font-size: 11px; font-weight: bold; color: #333; background-color: rgba(255, 255, 255, 0.7);
    padding: 1px 4px; border-radius: 3px; white-space: nowrap; margin: 0; text-align: center;
}
.theme-dark .piece-name-wrapper .piece-name { color: #fff; background-color: rgba(0, 0, 0, 0.6); }

/* --- 6. 棋盘控制区 --- */
.board-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.board-controls-left { display: flex; gap: 10px; align-items: center; }
.import-export { display: flex; gap: 5px; }
#import-input { border: 1px solid #ced4da; border-radius: 4px; padding: 5px 8px; font-size: 12px; width: 150px; }
.board-controls button {
    padding: 5px 10px; font-size: 12px; font-weight: bold; border: 1px solid #ced4da;
    background-color: #f8f9fa; color: #495057; border-radius: 4px; cursor: pointer; transition: all 0.2s ease;
}
.board-controls button:hover { background-color: #e9ecef; }
#clear-board-btn { border-color: #dc3545; color: #dc3545; }
#clear-board-btn:hover { background-color: #dc3545; color: #fff; }
#import-btn { border-color: #28a745; color: #28a745; }
#import-btn:hover { background-color: #28a745; color: #fff; }

.board-hint {
    background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404;
    padding: 8px 12px; border-radius: 6px; font-size: 13px; margin-bottom: 10px;
}

/* --- 7. 棋盘核心 (Flexbox重构版) --- */
.board-wrapper {
    position: relative; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px;
    box-sizing: border-box; display: flex; flex-direction: column; width: 100%; overflow: auto;
   background: #b7dabc; border-color: #a4d6ad;
    transition: background-color 0.3s ease;
    align-items: center; 
}

.board-wrapper.theme-dark { background: #495057; border-color: #343a40; }
.board-wrapper.theme-dark .item-bg { background: #6c757d; border-color: #909aa3; }
.board-wrapper.theme-blue { background: #e6f2ff; border-color: #b3d7ff; }
.board-wrapper.theme-blue .item-bg { background: #cce5ff; border-color: #b8daff; }

/* --- V39: 全向缩放便利贴 --- */
.notes-wrapper {
    position: absolute;
    top: 10px; right: 10px;
    width: 250px; height: 200px;
    min-width: 180px; min-height: 150px;
    z-index: 100;
    border-radius: 4px;
    border: 1px solid rgba(255, 255, 255, 0.4);
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    backdrop-filter: blur(8px);
    display: flex; flex-direction: column;
}

/* 拖拽把手 */
.notes-drag-handle {
    height: 28px; background-color: rgba(0,0,0,0.05);
    cursor: move; display: flex; align-items: center; justify-content: center;
    font-size: 12px; font-weight: bold; color: #6c757d;
    border-bottom: 1px solid rgba(255,255,255,0.2); user-select: none;
}
.notes-drag-handle:hover { background-color: rgba(0,0,0,0.1); }

/* 工具栏 */
.notes-toolbar {
    display: flex; gap: 5px; padding: 4px 8px;
    background-color: rgba(255, 255, 255, 0.4);
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
    flex-shrink: 0;
}
.note-tool-btn {
    background: none; border: none; cursor: pointer;
    padding: 2px 6px; font-size: 13px; border-radius: 3px;
    color: #495057; transition: background 0.2s;
}
.note-tool-btn:hover { background-color: rgba(0,0,0,0.1); }
.color-picker-wrapper { position: relative; cursor: pointer; padding: 2px 4px; border-radius: 3px; }
.color-picker-wrapper:hover { background-color: rgba(0,0,0,0.1); }
.color-picker-wrapper input[type="color"] { position: absolute; left: 0; top: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }

/* 编辑区 */
.board-notes {
    flex-grow: 1; padding: 10px; font-size: 14px; line-height: 1.5;
    outline: none; color: #2c3e50; cursor: text; overflow-y: auto; background: transparent;
}
.board-notes:empty::before { content: attr(placeholder); color: rgba(0, 0, 0, 0.4); font-style: italic; pointer-events: none; }

/* --- V39 新增: 8个方向的缩放手柄 --- */
.resizer {
    position: absolute; width: 10px; height: 10px; background: transparent; z-index: 101;
}
/* 顶部 */
.resizer-t { top: -5px; left: 0; width: 100%; height: 8px; cursor: n-resize; }
/* 底部 */
.resizer-b { bottom: -5px; left: 0; width: 100%; height: 8px; cursor: s-resize; }
/* 左侧 */
.resizer-l { top: 0; left: -5px; width: 8px; height: 100%; cursor: w-resize; }
/* 右侧 */
.resizer-r { top: 0; right: -5px; width: 8px; height: 100%; cursor: e-resize; }
/* 四角 */
.resizer-tl { top: -5px; left: -5px; cursor: nw-resize; }
.resizer-tr { top: -5px; right: -5px; cursor: ne-resize; }
.resizer-bl { bottom: -5px; left: -5px; cursor: sw-resize; }
.resizer-br { bottom: -5px; right: -5px; cursor: se-resize; }

/* 视觉增强：鼠标悬停在边框时显示明显的高亮线，提示可缩放 */
.notes-wrapper:hover { border-color: rgba(0, 123, 255, 0.5); box-shadow: 0 8px 24px rgba(0,0,0,0.2); }
.resizer-t:hover { border-top: 3px solid #007bff; }
.resizer-b:hover { border-bottom: 3px solid #007bff; }
.resizer-l:hover { border-left: 3px solid #007bff; }
.resizer-r:hover { border-right: 3px solid #007bff; }
/* 角落加点 */
.resizer-tl:hover, .resizer-tr:hover, .resizer-bl:hover, .resizer-br:hover {
    background-color: #007bff; border-radius: 50%; opacity: 0.8;
}

/* 便利贴主题色适配 */
.board-wrapper.theme-green .notes-wrapper { background-color: rgba(255, 255, 255, 0.5); }
.board-wrapper.theme-dark .notes-wrapper { background-color: rgba(40, 44, 52, 0.85); border-color: #495057; box-shadow: 0 8px 24px rgba(0,0,0,0.5);}
.board-wrapper.theme-dark .notes-drag-handle { color: #adb5bd; background-color: rgba(255,255,255,0.05); border-bottom-color: #495057;}
.board-wrapper.theme-dark .board-notes { color: #e9ecef; }
.board-wrapper.theme-dark .board-notes:empty::before { color: rgba(255, 255, 255, 0.3); }
.board-wrapper.theme-dark .note-tool-btn { color: #ced4da; }
.board-wrapper.theme-blue .notes-wrapper { background-color: rgba(255, 255, 255, 0.6); border-color: #b8daff; }
.board-wrapper.theme-blue .board-notes { color: #004085; }

/* 移动端: 取消缩放 */
@media (max-width: 768px) {
    .notes-wrapper { 
        position: relative; top: 0; left: 0; width: 95%; height: auto; min-height: 150px;
        margin: 10px auto; resize: none; z-index: 10;
    }
    .notes-drag-handle, .resizer { display: none; }
}

/* Grid & Slots 保持不变 */
.board-grid-container { display: flex; flex-direction: column; align-items: center; gap: 4px; padding-bottom: 20px; min-width: fit-content; }
.board-row { display: flex; justify-content: center; gap: 4px; }
.board-slot { width: 60px; height: 80px; box-sizing: border-box; flex-shrink: 0; position: relative; background: transparent; border: none; display: flex; align-items: flex-start; justify-content: center; }
.board-slot.item { cursor: pointer; }
.item-bg { width: 60px; height: 60px; position: absolute; top: 0; left: 0; border: 1px dashed #d1d5d9; background: #e9ecef; transition: all 0.2s; z-index: 1; border-radius: 4px; }
.board-slot.item:hover .item-bg { background: #d4edda; border-color: #8fcc95; }
.board-slot.drag-over .item-bg { background-color: #d4edda; border-color: #28a745; }

/* 杂项保持不变 */
.tips-container { background-color: #e6f7ff; border: 1px solid #b3e0ff; border-radius: 6px; padding: 10px; margin-bottom: 15px; }
.tip-item { font-size: 13px; color: #0056b3; line-height: 1.6; margin-bottom: 5px;}
#synergy-list { list-style: none; padding: 0; margin: 0; }
.synergy-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; margin-bottom: 8px; background-color: #e9ecef; border-radius: 4px; font-size: 14px; color: #6c757d; border-left: 3px solid #6c757d; transition: all 0.2s ease; cursor: pointer; }
.synergy-item.active { background-color: #d4edda; color: #155724; border-left-color: #28a745; font-weight: bold; }
.synergy-item.active-max { background-color: #fff3cd; color: #856404; border-left-color: #ffc107; }
.synergy-item-info { flex-grow: 1; pointer-events: none; }
.add-synergy-btn { margin-left: 10px; padding: 2px 8px; font-size: 16px; font-weight: bold; color: #007bff; background-color: #e6f2ff; border: 1px solid #007bff; border-radius: 50%; cursor: pointer; }
.add-synergy-btn:hover { background-color: #007bff; color: #fff; }

/* 羁绊悬浮窗 (复用基础样式，棋子悬浮窗也用这个风格) */
#synergy-tooltip, #piece-tooltip { 
    display: none; 
    position: absolute; 
    width: 320px; /* V42: 稍微加宽以适应头像 */
    background: rgba(40, 44, 52, 0.95); 
    color: #f8f9fa; 
    border: 1px solid #6c757d; 
    border-radius: 8px; 
    padding: 12px; 
    z-index: 2000; /* 确保比任何棋子都高 */
    pointer-events: none; 
    box-shadow: 0 4px 12px rgba(0,0,0,0.5); 
}

#synergy-tooltip h4, #piece-tooltip h4 { 
    margin: 0 0 10px 0; 
    border-bottom: 1px solid #495057; 
    padding-bottom: 5px; 
    color: #ffd700; /* 金色标题 */
}

/* 棋子技能特有样式 */
.piece-tooltip-skill {
    font-size: 13px;
    line-height: 1.5;
    color: #e9ecef;
}

.synergy-desc { font-size: 12px; color: #e9ecef; font-style: italic; margin-bottom: 10px; background: #333; padding: 5px; border-radius: 4px;}

/* --- V42 更新: 羁绊悬浮窗内部头像网格样式 --- */
.synergy-pieces-list { 
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); /* 自适应列，每列最小60px */
    gap: 8px;
    margin-top: 10px;
}

.synergy-tooltip-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.synergy-tooltip-img-wrapper {
    width: 40px;
    height: 40px;
    border: 2px solid #555;
    border-radius: 4px;
    overflow: hidden;
    background: #333;
    transition: border-color 0.2s;
    margin-bottom: 4px;
}

.synergy-tooltip-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

/* 名字样式 */
.synergy-tooltip-name {
    font-size: 10px;
    color: #adb5bd; /* 默认灰色 */
}

/* 缺失（未上场）状态：灰色滤镜 */
.synergy-tooltip-item.missing .synergy-tooltip-img {
    filter: grayscale(100%);
    opacity: 0.6;
}
.synergy-tooltip-item.missing .synergy-tooltip-name {
    color: #6c757d; /* 更暗的灰色 */
}

/* 激活（已上场）状态：彩色，高亮 */
.synergy-tooltip-item.active .synergy-tooltip-img {
    filter: none;
    opacity: 1;
}
.synergy-tooltip-item.active .synergy-tooltip-name {
    color: #fff; /* 亮白色 */
    font-weight: bold;
    text-shadow: 0 0 2px rgba(0,0,0,0.8);
}

/* 激活状态下的边框颜色 (根据品质) */
.synergy-tooltip-item.active .synergy-tooltip-img-wrapper.quality-金 { border-color: #ffc107; }
.synergy-tooltip-item.active .synergy-tooltip-img-wrapper.quality-紫 { border-color: #bd69ff; }
.synergy-tooltip-item.active .synergy-tooltip-img-wrapper.quality-蓝 { border-color: #5ba4fc; }


#message-box { display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 12px 25px; background-color: #dc3545; color: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 2000; transition: top 0.3s, opacity 0.3s; }
#message-box.success { background-color: #28a745; }
.download-link-container { margin-top: auto; padding-top: 15px; border-top: 1px solid #e0e0e0; text-align: center; }
.download-btn { display: block; padding: 10px; background-color: #007bff; color: #fff; text-decoration: none; border-radius: 4px; font-size: 14px;}
.download-btn:hover { background-color: #0056b3; }

/* --- V40: 便利贴折叠功能 --- */

/* 折叠按钮样式 */
.note-toggle-btn {
    background: transparent;
    border: none;
    cursor: pointer;
    font-size: 12px;
    color: #6c757d;
    margin-left: auto; /* 靠右对齐 */
    padding: 0 5px;
    transition: transform 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}
.note-toggle-btn:hover {
    color: #007bff;
    transform: scale(1.2);
}

/* 折叠状态下的核心样式 */
.notes-wrapper.collapsed {
    /* 使用 !important 覆盖 JS 拖拽缩放设置的内联 width/height */
    width: 130px !important; 
    height: 32px !important;
    min-width: 0 !important;
    min-height: 0 !important;
    overflow: hidden;
    background-color: rgba(255, 255, 255, 0.95); /* 折叠时背景稍微不透明一点 */
    border-radius: 16px; /* 折叠时圆润一点 */
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    border-color: #ccc;
}

/* 折叠时隐藏：工具栏、内容区、四周缩放手柄 */
.notes-wrapper.collapsed .notes-toolbar,
.notes-wrapper.collapsed .board-notes,
.notes-wrapper.collapsed .resizer {
    display: none !important;
}

/* 折叠时的拖拽栏调整 */
.notes-wrapper.collapsed .notes-drag-handle {
    border-bottom: none; /* 移除分割线 */
    height: 100%; /* 充满整个小方块 */
    background-color: transparent;
    padding: 0 10px;
    justify-content: space-between; /* 文字和按钮两端对齐 */
}

/* 简单的过渡动画 */
.notes-wrapper {
    transition: width 0.3s ease, height 0.3s ease, opacity 0.3s, border-radius 0.3s;
}

/* --- 棋子悬浮窗标签样式 --- */

/* --- 名字旁边的羁绊胶囊 (高对比清晰版) --- */
.tag-synergy {
    display: inline-block;
    vertical-align: middle;
    font-size: 13px;
    padding: 2px 8px;
    margin-left: 8px;
    border-radius: 4px; /* 与下方标签统一风格 */
    
    font-weight: 700;
    line-height: normal;
    position: relative;
    top: -2px;

    /* 采用一种中性偏绿/青的配色，与红蓝金区分开 */
    background-color: #f6ffed; /* 实色淡绿 */
    color: #389e0d;            /* 深绿 */
    border: 1px solid #b7eb8f; /* 中等绿边框 */
}

/* --- 棋子特性胶囊 (高对比清晰版) --- */
.piece-tags-container {
    margin-bottom: 10px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.piece-tag {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    
    /* 保持大尺寸 */
    padding: 4px 10px;   /* 稍微紧凑一点点，但依然很大 */
    font-size: 13px;     /* 清晰的字号 */
    font-weight: 700;    /* 加粗，让字更实 */
    border-radius: 4px;  /* 改回稍微方一点的圆角，看起来更像“标签”而非“按钮”，更利于阅读 */
    
    border: 1px solid;   /* 加上边框增强轮廓 */
    cursor: default;
}

/* 蓝色 - 内功/外功 */
/* 配色逻辑：极淡蓝底 + 深蓝接近黑的字 */
.tag-blue {
    background-color: #e8f4ff; /* 实色淡蓝 */
    color: #0958d9;            /* 深宝蓝，对比度极高 */
    border-color: #91caff;     /* 中等蓝边框 */
}

/* 红色 - 近战/远程 */
/* 配色逻辑：极淡红底 + 深红接近黑的字 */
.tag-red {
    background-color: #fff1f0; /* 实色淡红 */
    color: #cf1322;            /* 深红 */
    border-color: #ffa39e;     /* 中等红边框 */
}

/* 金色 - 功能 */
/* 配色逻辑：极淡黄底 + 深褐接近黑的字 */
.tag-gold {
    background-color: #fffbe6; /* 实色淡黄 */
    color: #d48806;            /* 深褐金 */
    border-color: #ffe58f;     /* 中等黄边框 */
}

/* --- 8. 筛选功能样式 (新增) --- */

/* 筛选容器 */
.filter-container {
    margin-bottom: 15px;
    padding: 10px;
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 6px;
}

.filter-group {
    margin-bottom: 8px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}
.filter-group:last-child { margin-bottom: 0; }

/* 筛选标签标题 */
.filter-label {
    font-size: 12px;
    font-weight: bold;
    color: #6c757d;
    margin-right: 4px;
    display: flex;
    align-items: center;
}

/* 筛选胶囊按钮 */
.filter-tag-btn {
    font-size: 12px;
    padding: 2px 8px;
    border: 1px solid #ced4da;
    background-color: #fff;
    border-radius: 12px;
    cursor: pointer;
    color: #495057;
    transition: all 0.2s;
}

.filter-tag-btn:hover {
    background-color: #e9ecef;
}

/* 选中状态 */
.filter-tag-btn.active {
    background-color: #343a40;
    color: #fff;
    border-color: #343a40;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

/* 筛选结果的分组标题 */
.group-header {
    width: 100%;
    font-size: 13px;
    font-weight: bold;
    color: #495057;
    border-bottom: 2px solid #e9ecef;
    padding-bottom: 4px;
    margin: 15px 0 10px 0;
}
.group-header:first-child { margin-top: 0; }

/* 筛选模式下的网格容器 */
.group-grid {
    display: grid;
    grid-template-columns: repeat(4, 60px);
    gap: 10px;
    justify-content: center;
}

/* 当处于筛选模式时，主列表不再使用 grid，而是由内部的 .group-grid 接管 */
#piece-list.filter-mode {
    display: block; 
}

/* --- 底部鸣谢区域样式 (带名字版) --- */
.credits-section {
    flex-shrink: 0; 
    margin-top: 10px; 
    padding-top: 10px;
    border-top: 1px solid #e9ecef;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.credits-title {
    font-size: 11px;
    color: #8b949e;
    font-weight: bold;
    padding-left: 5px;
}

.credits-avatars {
    display: flex;
    gap: 12px; /* 增加一点间距 */
    padding: 0 5px;
    overflow-x: auto; /* 允许横向滚动 */
    align-items: flex-start; /* 顶部对齐 */
    padding-bottom: 5px; /* 给滚动条留点位置 */
}

/* 隐藏滚动条 (Chrome/Safari) */
.credits-avatars::-webkit-scrollbar { display: none; }

.avatar-link {
    display: flex;          /* 改为 Flex 布局 */
    flex-direction: column; /* 垂直排列：上图下文 */
    align-items: center;    /* 居中对齐 */
    text-decoration: none;
    width: 48px;            /* 限制宽度，防止名字太长撑乱布局 */
    flex-shrink: 0;         /* 防止被挤压 */
    transition: transform 0.2s ease;
}

.avatar-link:hover {
    transform: translateY(-3px);
}

.avatar-link img {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transition: border-color 0.2s;
    display: block;
    margin-bottom: 4px; /* 图片和名字的间距 */
}

/* 名字样式 */
.credit-name {
    font-size: 10px;      /* 字号要小 */
    color: #6c757d;       /* 灰色文字 */
    text-align: center;
    width: 100%;
    
    /* 如果名字太长，自动变成省略号... */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.avatar-link:hover img { border-color: #ffc107; }
.avatar-link:hover .credit-name { color: #333; font-weight: bold; } /* 悬停时名字变深 */

.avatar-placeholder {
    width: 36px; 
    height: 36px;
    border-radius: 50%;
    background: #f1f3f5;
    color: #adb5bd;
    display: flex; 
    align-items: center; 
    justify-content: center;
    font-weight: bold;
    border: 1px dashed #ced4da;
    box-sizing: border-box;
    margin-bottom: 4px;
}

/* --- 底部关于/版权说明区域样式 --- */
.about-section {
    flex-shrink: 0; /* 防止被压缩 */
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px dashed #e9ecef; /* 使用虚线与上方的鸣谢区分开 */
    
    text-align: center;
    font-size: 11px; /* 字号较小，保持精致感 */
    color: #8b949e;
    line-height: 1.6;
}

.about-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
}

/* 作者链接样式 */
.about-link {
    color: #007bff;
    text-decoration: none;
    font-weight: bold;
    transition: color 0.2s;
}

.about-link:hover {
    color: #0056b3;
    text-decoration: underline;
}

/* 第二行辅助信息 (参考 & AI) */
.sub-info {
    font-size: 10px; /* 比作者名更小一点 */
    color: #adb5bd;
}

.divider {
    color: #dee2e6;
    margin: 0 2px;
}

/* 鼠标悬停在 AI 字样上时稍微深一点 */
.sub-info span:hover {
    color: #6c757d;
    cursor: default;
}

/* --- 标题栏迷你时钟样式 --- */
.mini-clock {
    display: flex;
    align-items: center;
    gap: 8px; /* 时间和提示语的间距 */
    font-weight: normal; /* 重置权重 */
}

.clock-time {
    font-family: "Segoe UI", "Roboto", sans-serif;
    font-size: 15px; /* 字号缩小 (原24px) */
    font-weight: bold;
    color: #495057;
    line-height: 1;
    font-feature-settings: "tnum"; /* 等宽数字，防止跳动 */
}

.clock-tips {
    font-size: 10px; /* 字号极小，精致感 */
    padding: 2px 6px;
    border-radius: 4px;
    white-space: nowrap; /* 防止换行撑开高度 */
    
    /* 默认浅蓝风格 */
    color: #007bff;
    background-color: rgba(0, 123, 255, 0.08);
    font-weight: normal;
    letter-spacing: 0.5px;
}

/* 深夜警告样式 (JS会自动切换) */
.clock-tips.late-night {
    color: #dc3545; 
    background-color: rgba(220, 53, 69, 0.1);
}


/* =========================================
   8. 移动端 & 平板适配 (响应式 + 触摸优化)
   ========================================= */

@media screen and (max-width: 1366px) {
    
    body {
        display: block; 
        height: auto; 
        overflow-y: auto;
        -webkit-overflow-scrolling: touch; /* iOS 滚动优化 */
    }

    #page-wrapper {
        padding: 10px;
        height: auto; 
        overflow: visible;
    }

    #app-container {
        flex-direction: column; 
        align-items: center;
        gap: 15px;
        height: auto !important;
    }

    /* --- 左侧面板 (选棋子) --- */
    #left-panel {
        width: 100% !important; /* 强制占满宽 */
        max-width: 100%;
        height: auto;
        max-height: none; /* 取消高度限制，让棋子全显示出来 */
        padding: 10px;
        order: 2; /* 放在棋盘下面 */
    }

    /* 强制棋子列表换行，不要横向滚动，那样很难选 */
    #piece-list {
        display: grid !important; /* 强制使用 Grid */
        grid-template-columns: repeat(auto-fill, minmax(55px, 1fr)); /* 自适应列宽 */
        gap: 8px;
        height: auto;
        overflow: visible;
        padding-bottom: 0;
        justify-content: center;
    }

    /* 确保左侧面板里的棋子大小合适 */
    #left-panel .piece {
        width: 100%; /* 填满格子 */
        height: 75px;
        margin: 0 auto;
    }

/* --- 中间面板 (棋盘) --- */
    #middle-panel {
        width: 100%;
        height: auto;
        padding: 0; /* 手机上减少内边距 */
        border: none;
        box-shadow: none;
        background: transparent;
        
        /* 【关键】允许横向和纵向滚动 */
        overflow: auto; 
        display: block; /* 改回 block 方便滚动 */
        order: 1; 
        margin-bottom: 20px;
    }

    /* 棋盘容器 */
    .board-wrapper {
        /* 【关键】固定一个稍微缩小但依然清晰的比例 */
        transform: scale(0.75); 
        transform-origin: top left; /* 从左上角开始缩放 */
        
        /* 只有 scale 还不够，因为 DOM 占位没变，
           我们需要强制指定一个宽度，让滚动条能识别到它的真实大小 */
        width: 1080px !important; 
        
        margin: 0;
        border: none;
        background: transparent; /* 手机上可能不需要背景框，显得干净点 */
        overflow: visible; /* 滚动由父元素 middle-panel 负责 */
    }

    /* 调整一下手机上棋盘格子的间距，让它紧凑点 */
    .board-grid-container {
        gap: 2px; /* 减小格子间隙 */
    }

    /* --- 右侧面板 (羁绊) --- */
    #right-panel {
        width: 100%;
        height: auto;
        order: 3;
        margin-bottom: 50px;
    }
    
    /* 隐藏非核心元素以节省空间 */
    .download-link-container, .about-section {
        display: none;
    }
}